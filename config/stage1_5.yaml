experiment:
  seed: 1337
  accents: ["NE", "SE", "S"]
  min_f1_go: 0.55
  min_f1_conditional: 0.45
  leakage_margin_pp: 7
  leakage_conditional_margin_pp: 12
  text_drop_tolerance_pp: 10

paths:
  manifest: data/manifest.jsonl
  splits_dir: data/splits
  artifacts_root: artifacts
  acoustic_features: artifacts/features/acoustic
  ecapa_embeddings: artifacts/features/ecapa
  ssl_features: artifacts/features/ssl
  backbone_features: artifacts/features/backbone
  probes: artifacts/probes
  analysis: artifacts/analysis
  report: report/stage1_5_report.md

audio:
  sample_rate: 16000
  vad:
    enabled: false
    threshold: 0.02

backbone:
  provider: qwen3_tts
  checkpoint: "Qwen/Qwen3-TTS-12Hz-1.7B-CustomVoice"
  device: cuda
  dtype: "bfloat16"
  attn_implementation: "kernels-community/flash-attn3"
  layers:
    - text_encoder_out
    - decoder_block_04
    - decoder_block_08
    - pre_vocoder
  generation:
    enabled: true
    mode: custom_voice
    language: Portuguese
    speaker: "ryan"
    texts_path: data/texts.jsonl
    output_dir: gen/synthetic_audio
    max_new_tokens: 2048

ssl:
  model: wavlm_large
  layers: [0, 6, 12, 18, 24]
  device: cuda
  pooling: mean

probes:
  model: logistic_regression
  max_iter: 4000
  test_size: 0.25
  speaker_disjoint: true
  accent_metric: f1_macro
  speaker_metric: accuracy

  feature_spaces:
    - name: acoustic
      root: artifacts/features/acoustic
      keys: ["mfcc_mean", "mfcc_std", "f0_stats", "speaking_rate"]
      combine: true
      target: accent

    - name: ssl
      root: artifacts/features/ssl
      combine: false
      targets: [accent, speaker]

    - name: backbone
      root: artifacts/features/backbone
      combine: false
      targets: [accent, speaker]

    - name: ecapa
      root: artifacts/features/ecapa
      keys: ["ecapa"]
      combine: true
      target: speaker

analysis:
  metrics_csv: artifacts/analysis/metrics.csv
  heatmap_dir: artifacts/analysis/figures
